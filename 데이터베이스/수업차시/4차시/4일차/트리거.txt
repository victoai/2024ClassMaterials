CREATE OR REPLACE TRIGGER trg_order_decrease_inventory
AFTER INSERT ON orders -- 주문이 들어왔을 때 트리거 실행
FOR EACH ROW
DECLARE
    v_product_id NUMBER;
    v_quantity NUMBER;
BEGIN
    -- 주문된 상품의 ID와 수량을 가져옴
    v_product_id := :NEW.product_id; -- 상품 ID는 트리거가 실행된 행의 주문 정보에서 가져옴
    v_quantity := :NEW.quantity;     -- 주문 수량도 가져옴
    
    -- 상품 재고를 주문 수량만큼 감소시킴
    UPDATE products
    SET inventory = inventory - v_quantity
    WHERE product_id = v_product_id;
    
    COMMIT; -- 변경 사항 커밋
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK; -- 오류 발생 시 롤백
        RAISE;    -- 오류 재발생
END;
/
